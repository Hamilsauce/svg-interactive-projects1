(function(){var $,Ajax,Base,Collection,Extend,Include,Model,Queue,Singleton,Spine,__slice=[].slice,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Spine=this.Spine||require("spine");$=Spine.$;Model=Spine.Model;Queue=$({});Ajax={getURL:function(object){return(typeof object.url==="function"?object.url():void 0)||object.url},getCollectionURL:function(object){if(object){if(typeof object.url==="function"){return this.generateURL(object)}else{return object.url}}},getScope:function(object){return(typeof object.scope==="function"?object.scope():void 0)||object.scope},generateURL:function(){var args,collection,object,path,scope;object=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];if(object.className){collection=object.className.toLowerCase()+"s";scope=Ajax.getScope(object)}else{if(typeof object.constructor.url==="string"){collection=object.constructor.url}else{collection=object.constructor.className.toLowerCase()+"s"}scope=Ajax.getScope(object)||Ajax.getScope(object.constructor)}args.unshift(collection);args.unshift(scope);path=args.join("/");path=path.replace(/(\/\/)/g,"/");path=path.replace(/^\/|\/$/g,"");if(path.indexOf("../")!==0){return Model.host+"/"+path}else{return path}},enabled:true,disable:function(callback){var e;if(this.enabled){this.enabled=false;try{return callback()}catch(_error){e=_error;throw e}finally{this.enabled=true}}else{return callback()}},queue:function(request){if(request){return Queue.queue(request)}else{return Queue.queue()}},clearQueue:function(){return this.queue([])}};Base=function(){function Base(){}Base.prototype.defaults={dataType:"json",processData:false,headers:{"X-Requested-With":"XMLHttpRequest"}};Base.prototype.queue=Ajax.queue;Base.prototype.ajax=function(params,defaults){return $.ajax(this.ajaxSettings(params,defaults))};Base.prototype.ajaxQueue=function(params,defaults,record){var deferred,jqXHR,promise,request,settings;jqXHR=null;deferred=$.Deferred();promise=deferred.promise();if(!Ajax.enabled){return promise}settings=this.ajaxSettings(params,defaults);request=function(next){var _ref;if((record!=null?record.id:void 0)!=null){if(settings.url==null){settings.url=Ajax.getURL(record)}if((_ref=settings.data)!=null){_ref.id=record.id}}settings.data=JSON.stringify(settings.data);return jqXHR=$.ajax(settings).done(deferred.resolve).fail(deferred.reject).then(next,next)};promise.abort=function(statusText){var index;if(jqXHR){return jqXHR.abort(statusText)}index=$.inArray(request,this.queue());if(index>-1){this.queue().splice(index,1)}deferred.rejectWith(settings.context||settings,[promise,statusText,""]);return promise};this.queue(request);return promise};Base.prototype.ajaxSettings=function(params,defaults){return $.extend({},this.defaults,defaults,params)};return Base}();Collection=function(_super){__extends(Collection,_super);function Collection(model){this.model=model;this.failResponse=__bind(this.failResponse,this);this.recordsResponse=__bind(this.recordsResponse,this)}Collection.prototype.find=function(id,params,options){var record;if(options==null){options={}}record=new this.model({id:id});return this.ajaxQueue(params,{type:"GET",url:options.url||Ajax.getURL(record)}).done(this.recordsResponse).fail(this.failResponse)};Collection.prototype.all=function(params,options){if(options==null){options={}}return this.ajaxQueue(params,{type:"GET",url:options.url||Ajax.getURL(this.model)}).done(this.recordsResponse).fail(this.failResponse)};Collection.prototype.fetch=function(params,options){var id,_this=this;if(params==null){params={}}if(options==null){options={}}if(id=params.id){delete params.id;return this.find(id,params,options).done(function(record){return _this.model.refresh(record,options)})}else{return this.all(params,options).done(function(records){return _this.model.refresh(records,options)})}};Collection.prototype.recordsResponse=function(data,status,xhr){return this.model.trigger("ajaxSuccess",null,status,xhr)};Collection.prototype.failResponse=function(xhr,statusText,error){return this.model.trigger("ajaxError",null,xhr,statusText,error)};return Collection}(Base);Singleton=function(_super){__extends(Singleton,_super);function Singleton(record){this.record=record;this.failResponse=__bind(this.failResponse,this);this.recordResponse=__bind(this.recordResponse,this);this.model=this.record.constructor}Singleton.prototype.reload=function(params,options){if(options==null){options={}}return this.ajaxQueue(params,{type:"GET",url:options.url},this.record).done(this.recordResponse(options)).fail(this.failResponse(options))};Singleton.prototype.create=function(params,options){if(options==null){options={}}return this.ajaxQueue(params,{type:"POST",contentType:"application/json",data:this.record.toJSON(),url:options.url||Ajax.getCollectionURL(this.record)}).done(this.recordResponse(options)).fail(this.failResponse(options))};Singleton.prototype.update=function(params,options){if(options==null){options={}}return this.ajaxQueue(params,{type:"PUT",contentType:"application/json",data:this.record.toJSON(),url:options.url},this.record).done(this.recordResponse(options)).fail(this.failResponse(options))};Singleton.prototype.destroy=function(params,options){if(options==null){options={}}return this.ajaxQueue(params,{type:"DELETE",url:options.url},this.record).done(this.recordResponse(options)).fail(this.failResponse(options))};Singleton.prototype.recordResponse=function(options){var _this=this;if(options==null){options={}}return function(data,status,xhr){var _ref,_ref1;Ajax.disable(function(){if(!(Spine.isBlank(data)||_this.record.destroyed)){if(data.id&&_this.record.id!==data.id){_this.record.changeID(data.id)}return _this.record.refresh(data)}});_this.record.trigger("ajaxSuccess",data,status,xhr);if((_ref=options.success)!=null){_ref.apply(_this.record)}return(_ref1=options.done)!=null?_ref1.apply(_this.record):void 0}};Singleton.prototype.failResponse=function(options){var _this=this;if(options==null){options={}}return function(xhr,statusText,error){var _ref,_ref1;_this.record.trigger("ajaxError",xhr,statusText,error);if((_ref=options.error)!=null){_ref.apply(_this.record)}return(_ref1=options.fail)!=null?_ref1.apply(_this.record):void 0}};return Singleton}(Base);Model.host="";Include={ajax:function(){return new Singleton(this)},url:function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];args.unshift(encodeURIComponent(this.id));return Ajax.generateURL.apply(Ajax,[this].concat(__slice.call(args)))}};Extend={ajax:function(){return new Collection(this)},url:function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return Ajax.generateURL.apply(Ajax,[this].concat(__slice.call(args)))}};Model.Ajax={extended:function(){this.fetch(this.ajaxFetch);this.change(this.ajaxChange);this.extend(Extend);return this.include(Include)},ajaxFetch:function(){var _ref;return(_ref=this.ajax()).fetch.apply(_ref,arguments)},ajaxChange:function(record,type,options){if(options==null){options={}}if(options.ajax===false){return}return record.ajax()[type](options.ajax,options)}};Model.Ajax.Methods={extended:function(){this.extend(Extend);return this.include(Include)}};Ajax.defaults=Base.prototype.defaults;Ajax.Base=Base;Ajax.Singleton=Singleton;Ajax.Collection=Collection;Spine.Ajax=Ajax;if(typeof module!=="undefined"&&module!==null){module.exports=Ajax}}).call(this);(function(){var $,Spine,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Spine=this.Spine||require("spine");$=Spine.$;Spine.List=function(_super){__extends(List,_super);List.prototype.events={"click .item":"click"};List.prototype.selectFirst=false;function List(){this.change=__bind(this.change,this);List.__super__.constructor.apply(this,arguments);this.bind("change",this.change)}List.prototype.template=function(){throw"Override template"};List.prototype.change=function(item){this.current=item;if(!this.current){this.children().removeClass("active");return}this.children().removeClass("active");return $(this.children().get(this.items.indexOf(this.current))).addClass("active")};List.prototype.render=function(items){if(items){this.items=items}this.html(this.template(this.items));this.change(this.current);if(this.selectFirst){if(!this.children(".active").length){return this.children(":first").click()}}};List.prototype.children=function(sel){return this.el.children(sel)};List.prototype.click=function(e){var item;item=this.items[$(e.currentTarget).index()];this.trigger("change",item);return true};return List}(Spine.Controller);if(typeof module!=="undefined"&&module!==null){module.exports=Spine.List}}).call(this);(function(){var Spine;Spine=this.Spine||require("spine");Spine.Model.Local={extended:function(){this.change(this.saveLocal);return this.fetch(this.loadLocal)},saveLocal:function(){var result;result=JSON.stringify(this);return localStorage[this.className]=result},loadLocal:function(options){var result;if(options==null){options={}}if(!options.hasOwnProperty("clear")){options.clear=true}result=localStorage[this.className];return this.refresh(result||[],options)}};if(typeof module!=="undefined"&&module!==null){module.exports=Spine.Model.Local}}).call(this);(function(){var $,Spine,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__slice=[].slice;Spine=this.Spine||require("spine");$=Spine.$;Spine.Manager=function(_super){__extends(Manager,_super);Manager.include(Spine.Events);function Manager(){this.controllers=[];this.bind("change",this.change);this.add.apply(this,arguments)}Manager.prototype.add=function(){var cont,controllers,_i,_len,_results;controllers=1<=arguments.length?__slice.call(arguments,0):[];_results=[];for(_i=0,_len=controllers.length;_i<_len;_i++){cont=controllers[_i];_results.push(this.addOne(cont))}return _results};Manager.prototype.addOne=function(controller){var _this=this;controller.bind("active",function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return _this.trigger.apply(_this,["change",controller].concat(__slice.call(args)))});controller.bind("release",function(){return _this.controllers.splice(_this.controllers.indexOf(controller),1)});return this.controllers.push(controller)};Manager.prototype.deactivate=function(){return this.trigger.apply(this,["change",false].concat(__slice.call(arguments)))};Manager.prototype.change=function(){var args,cont,current,_i,_len,_ref;current=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];_ref=this.controllers;for(_i=0,_len=_ref.length;_i<_len;_i++){cont=_ref[_i];if(cont!==current){cont.deactivate.apply(cont,args)}}if(current){return current.activate.apply(current,args)}};return Manager}(Spine.Module);Spine.Controller.include({active:function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];if(typeof args[0]==="function"){this.bind("active",args[0])}else{args.unshift("active");this.trigger.apply(this,args)}return this},isActive:function(){return this.el.hasClass("active")},activate:function(){this.el.addClass("active");return this},deactivate:function(){this.el.removeClass("active");return this}});Spine.Stack=function(_super){__extends(Stack,_super);Stack.prototype.controllers={};Stack.prototype.routes={};Stack.prototype.className="spine stack";function Stack(){var key,value,_fn,_ref,_ref1,_this=this;Stack.__super__.constructor.apply(this,arguments);this.manager=new Spine.Manager;_ref=this.controllers;for(key in _ref){value=_ref[key];if(this[key]!=null){throw Error("'@"+key+"' already assigned - choose a different name")}this[key]=new value({stack:this});this.add(this[key])}_ref1=this.routes;_fn=function(key,value){var callback;if(typeof value==="function"){callback=value}callback||(callback=function(){var _ref2;return(_ref2=_this[value]).active.apply(_ref2,arguments)});return _this.route(key,callback)};for(key in _ref1){value=_ref1[key];_fn(key,value)}if(this["default"]){this[this["default"]].active()}}Stack.prototype.add=function(controller){this.manager.add(controller);return this.append(controller)};return Stack}(Spine.Controller);if(typeof module!=="undefined"&&module!==null){module.exports=Spine.Manager}if(typeof module!=="undefined"&&module!==null){module.exports.Stack=Spine.Stack}}).call(this);(function(){var Collection,Instance,Singleton,Spine,association,isArray,require,singularize,underscore,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Spine=this.Spine||require("spine");isArray=Spine.isArray;require=this.require||function(value){return eval(value)};Collection=function(_super){__extends(Collection,_super);function Collection(options){var key,value;if(options==null){options={}}for(key in options){value=options[key];this[key]=value}}Collection.prototype.all=function(){var _this=this;return this.model.select(function(rec){return _this.associated(rec)})};Collection.prototype.first=function(){return this.all()[0]};Collection.prototype.last=function(){var values;values=this.all();return values[values.length-1]};Collection.prototype.count=function(){return this.all().length};Collection.prototype.find=function(id){var records,_this=this;records=this.select(function(rec){return""+rec.id===""+id});if(!records[0]){throw new Error('"'+this.model.className+'" model could not find a record for the ID "'+id+'"')}return records[0]};Collection.prototype.findAllByAttribute=function(name,value){var _this=this;return this.model.select(function(rec){return _this.associated(rec)&&rec[name]===value})};Collection.prototype.findByAttribute=function(name,value){return this.findAllByAttribute(name,value)[0]};Collection.prototype.select=function(cb){var _this=this;return this.model.select(function(rec){return _this.associated(rec)&&cb(rec)})};Collection.prototype.refresh=function(values){var i,match,record,_i,_j,_k,_len,_len1,_len2,_ref,_ref1;if(values==null){return this}_ref=this.all();for(_i=0,_len=_ref.length;_i<_len;_i++){record=_ref[_i];delete this.model.irecords[record.id];_ref1=this.model.records;for(i=_j=0,_len1=_ref1.length;_j<_len1;i=++_j){match=_ref1[i];if(!(match.id===record.id)){continue}this.model.records.splice(i,1);break}}if(!isArray(values)){values=[values]}for(_k=0,_len2=values.length;_k<_len2;_k++){record=values[_k];record.newRecord=false;record[this.fkey]=this.record.id}this.model.refresh(values);return this};Collection.prototype.create=function(record,options){record[this.fkey]=this.record.id;return this.model.create(record,options)};Collection.prototype.add=function(record,options){return record.updateAttribute(this.fkey,this.record.id,options)};Collection.prototype.remove=function(record,options){return record.updateAttribute(this.fkey,null,options)};Collection.prototype.associated=function(record){return record[this.fkey]===this.record.id};return Collection}(Spine.Module);Instance=function(_super){__extends(Instance,_super);function Instance(options){var key,value;if(options==null){options={}}for(key in options){value=options[key];this[key]=value}}Instance.prototype.exists=function(){if(this.record[this.fkey]){return this.model.exists(this.record[this.fkey])}else{return false}};Instance.prototype.update=function(value){if(value==null){return this}if(!(value instanceof this.model)){value=new this.model(value)}if(value.isNew()){value.save()}this.record[this.fkey]=value&&value.id;return this};return Instance}(Spine.Module);Singleton=function(_super){__extends(Singleton,_super);function Singleton(options){var key,value;if(options==null){options={}}for(key in options){value=options[key];this[key]=value}}Singleton.prototype.find=function(){return this.record.id&&this.model.findByAttribute(this.fkey,this.record.id)};Singleton.prototype.update=function(value){if(value==null){return this}if(!(value instanceof this.model)){value=this.model.fromJSON(value)}value[this.fkey]=this.record.id;value.save();return this};return Singleton}(Spine.Module);singularize=function(str){return str.replace(/s$/,"")};underscore=function(str){return str.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()};association=function(name,model,record,fkey,Ctor){if(typeof model==="string"){model=require(model)}return new Ctor({name:name,model:model,record:record,fkey:fkey})};Spine.Model.extend({hasMany:function(name,model,fkey){if(fkey==null){fkey=""+underscore(this.className)+"_id"}return this.prototype[name]=function(value){return association(name,model,this,fkey,Collection).refresh(value)}},belongsTo:function(name,model,fkey){if(fkey==null){fkey=""+underscore(singularize(name))+"_id"}this.prototype[name]=function(value){return association(name,model,this,fkey,Instance).update(value).exists()};return this.attributes.push(fkey)},hasOne:function(name,model,fkey){if(fkey==null){fkey=""+underscore(this.className)+"_id"}return this.prototype[name]=function(value){return association(name,model,this,fkey,Singleton).update(value).find()}}});Spine.Collection=Collection;Spine.Singleton=Singleton;Spine.Instance=Instance}).call(this);(function(){var $,Spine,escapeRegExp,hashStrip,namedParam,splatParam,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__slice=[].slice;Spine=this.Spine||require("spine");$=Spine.$;hashStrip=/^#*/;namedParam=/:([\w\d]+)/g;splatParam=/\*([\w\d]+)/g;escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;Spine.Route=function(_super){var _ref;__extends(Route,_super);Route.extend(Spine.Events);Route.historySupport=((_ref=window.history)!=null?_ref.pushState:void 0)!=null;Route.routes=[];Route.options={trigger:true,history:false,shim:false,replace:false,redirect:false};Route.add=function(path,callback){var key,value,_results;if(typeof path==="object"&&!(path instanceof RegExp)){_results=[];for(key in path){value=path[key];_results.push(this.add(key,value))}return _results}else{return this.routes.push(new this(path,callback))}};Route.setup=function(options){if(options==null){options={}}this.options=$.extend({},this.options,options);if(this.options.history){this.history=this.historySupport&&this.options.history}if(this.options.shim){return}if(this.history){$(window).bind("popstate",this.change)}else{$(window).bind("hashchange",this.change)}return this.change()};Route.unbind=function(){if(this.options.shim){return}if(this.history){return $(window).unbind("popstate",this.change)}else{return $(window).unbind("hashchange",this.change)}};Route.navigate=function(){var args,lastArg,options,path,route;args=1<=arguments.length?__slice.call(arguments,0):[];options={};lastArg=args[args.length-1];if(typeof lastArg==="object"){options=args.pop()}else if(typeof lastArg==="boolean"){options.trigger=args.pop()}options=$.extend({},this.options,options);path=args.join("/");if(this.path===path){return}this.path=path;this.trigger("navigate",this.path);if(options.trigger){route=this.matchRoute(this.path,options)}if(options.shim){return}if(!route){if(typeof options.redirect==="function"){return options.redirect.apply(this,[this.path,options])}else{if(options.redirect===true){this.redirect(this.path)}}}if(this.history&&options.replace){return history.replaceState({},document.title,this.path)}else if(this.history){return history.pushState({},document.title,this.path)}else{return window.location.hash=this.path}};Route.getPath=function(){var path;if(this.history){path=window.location.pathname;if(path.substr(0,1)!=="/"){path="/"+path}}else{path=window.location.hash;path=path.replace(hashStrip,"")}return path};Route.getHost=function(){return""+window.location.protocol+"//"+window.location.host};Route.change=function(){var path;path=this.getPath();if(path===this.path){return}this.path=path;return this.matchRoute(this.path)};Route.matchRoute=function(path,options){var route,_i,_len,_ref1;_ref1=this.routes;for(_i=0,_len=_ref1.length;_i<_len;_i++){route=_ref1[_i];if(!route.match(path,options)){continue}this.trigger("change",route,path);return route}};Route.redirect=function(path){return window.location=path};function Route(path,callback){var match;this.path=path;this.callback=callback;this.names=[];if(typeof path==="string"){namedParam.lastIndex=0;while((match=namedParam.exec(path))!==null){this.names.push(match[1])}splatParam.lastIndex=0;while((match=splatParam.exec(path))!==null){this.names.push(match[1])}path=path.replace(escapeRegExp,"\\$&").replace(namedParam,"([^/]*)").replace(splatParam,"(.*?)");this.route=new RegExp("^"+path+"$")}else{this.route=path}}Route.prototype.match=function(path,options){var i,match,param,params,_i,_len;if(options==null){options={}}match=this.route.exec(path);if(!match){return false}options.match=match;params=match.slice(1);if(this.names.length){for(i=_i=0,_len=params.length;_i<_len;i=++_i){param=params[i];options[this.names[i]]=param}}return this.callback.call(null,options)!==false};return Route}(Spine.Module);Spine.Route.change=Spine.Route.proxy(Spine.Route.change);Spine.Controller.include({route:function(path,callback){return Spine.Route.add(path,this.proxy(callback))},routes:function(routes){var key,value,_results;_results=[];for(key in routes){value=routes[key];_results.push(this.route(key,value))}return _results},navigate:function(){return Spine.Route.navigate.apply(Spine.Route,arguments)}});if(typeof module!=="undefined"&&module!==null){module.exports=Spine.Route}}).call(this);(function(){var $,Controller,Events,Log,Model,Module,Spine,createObject,isArray,isBlank,makeArray,moduleKeywords,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Events={bind:function(ev,callback){var calls,evs,name,_i,_len;evs=ev.split(" ");calls=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(_i=0,_len=evs.length;_i<_len;_i++){name=evs[_i];calls[name]||(calls[name]=[]);calls[name].push(callback)}return this},one:function(ev,callback){var handler;return this.bind(ev,handler=function(){this.unbind(ev,handler);return callback.apply(this,arguments)})},trigger:function(){var args,callback,ev,list,_i,_len,_ref;args=1<=arguments.length?__slice.call(arguments,0):[];ev=args.shift();list=this.hasOwnProperty("_callbacks")&&((_ref=this._callbacks)!=null?_ref[ev]:void 0);if(!list){return}for(_i=0,_len=list.length;_i<_len;_i++){callback=list[_i];if(callback.apply(this,args)===false){break}}return true},listenTo:function(obj,ev,callback){obj.bind(ev,callback);this.listeningTo||(this.listeningTo=[]);this.listeningTo.push({obj:obj,ev:ev,callback:callback});return this},listenToOnce:function(obj,ev,callback){var handler,listeningToOnce;listeningToOnce=this.listeningToOnce||(this.listeningToOnce=[]);obj.bind(ev,handler=function(){var i,idx,lt,_i,_len;idx=-1;for(i=_i=0,_len=listeningToOnce.length;_i<_len;i=++_i){lt=listeningToOnce[i];if(lt.obj===obj){if(lt.ev===ev&&lt.callback===callback){idx=i}}}obj.unbind(ev,handler);if(idx!==-1){listeningToOnce.splice(idx,1)}return callback.apply(this,arguments)});listeningToOnce.push({obj:obj,ev:ev,callback:callback,handler:handler});return this},stopListening:function(obj,events,callback){var ev,evts,i,idx,listeningTo,lt,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_results;if(arguments.length===0){_ref=[this.listeningTo,this.listeningToOnce];for(_i=0,_len=_ref.length;_i<_len;_i++){listeningTo=_ref[_i];if(!listeningTo){continue}for(_j=0,_len1=listeningTo.length;_j<_len1;_j++){lt=listeningTo[_j];lt.obj.unbind(lt.ev,lt.handler||lt.callback)}}this.listeningTo=void 0;return this.listeningToOnce=void 0}else if(obj){_ref1=[this.listeningTo,this.listeningToOnce];_results=[];for(_k=0,_len2=_ref1.length;_k<_len2;_k++){listeningTo=_ref1[_k];if(!listeningTo){continue}events=events?events.split(" "):[void 0];_results.push(function(){var _l,_len3,_results1;_results1=[];for(_l=0,_len3=events.length;_l<_len3;_l++){ev=events[_l];_results1.push(function(){var _m,_ref2,_results2;_results2=[];for(idx=_m=_ref2=listeningTo.length-1;_ref2<=0?_m<=0:_m>=0;idx=_ref2<=0?++_m:--_m){lt=listeningTo[idx];if(!ev||ev===lt.ev){lt.obj.unbind(lt.ev,lt.handler||lt.callback);if(idx!==-1){_results2.push(listeningTo.splice(idx,1))}else{_results2.push(void 0)}}else if(ev){evts=lt.ev.split(" ");if(~(i=evts.indexOf(ev))){evts.splice(i,1);lt.ev=$.trim(evts.join(" "));_results2.push(lt.obj.unbind(ev,lt.handler||lt.callback))}else{_results2.push(void 0)}}else{_results2.push(void 0)}}return _results2}())}return _results1}())}return _results}},unbind:function(ev,callback){var cb,evs,i,list,name,_i,_j,_len,_len1,_ref;if(arguments.length===0){this._callbacks={};return this}if(!ev){return this}evs=ev.split(" ");for(_i=0,_len=evs.length;_i<_len;_i++){name=evs[_i];list=(_ref=this._callbacks)!=null?_ref[name]:void 0;if(!list){continue}if(!callback){delete this._callbacks[name];continue}for(i=_j=0,_len1=list.length;_j<_len1;i=++_j){cb=list[i];if(!(cb===callback)){continue}list=list.slice();list.splice(i,1);this._callbacks[name]=list;break}}return this}};Events.on=Events.bind;Events.off=Events.unbind;Log={trace:true,logPrefix:"(App)",log:function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];if(!this.trace){return}if(this.logPrefix){args.unshift(this.logPrefix)}if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log.apply(console,args)}}return this}};moduleKeywords=["included","extended"];Module=function(){Module.include=function(obj){var key,value,_ref;if(!obj){throw new Error("include(obj) requires obj")}for(key in obj){value=obj[key];if(__indexOf.call(moduleKeywords,key)<0){this.prototype[key]=value}}if((_ref=obj.included)!=null){_ref.apply(this)}return this};Module.extend=function(obj){var key,value,_ref;if(!obj){throw new Error("extend(obj) requires obj")}for(key in obj){value=obj[key];if(__indexOf.call(moduleKeywords,key)<0){this[key]=value}}if((_ref=obj.extended)!=null){_ref.apply(this)}return this};Module.proxy=function(func){var _this=this;return function(){return func.apply(_this,arguments)}};Module.prototype.proxy=function(func){var _this=this;return function(){return func.apply(_this,arguments)}};function Module(){if(typeof this.init==="function"){this.init.apply(this,arguments)}}return Module}();Model=function(_super){__extends(Model,_super);Model.extend(Events);Model.records=[];Model.irecords={};Model.attributes=[];Model.configure=function(){var attributes,name;name=arguments[0],attributes=2<=arguments.length?__slice.call(arguments,1):[];this.className=name;this.deleteAll();if(attributes.length){this.attributes=attributes}this.attributes&&(this.attributes=makeArray(this.attributes));this.attributes||(this.attributes=[]);this.unbind();return this};Model.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"};Model.find=function(id){var record;record=this.exists(id);if(!record){throw new Error('"'+this.className+'" model could not find a record for the ID "'+id+'"')}return record};Model.exists=function(id){var _ref;return(_ref=this.irecords[id])!=null?_ref.clone():void 0};Model.addRecord=function(record){if(record.id&&this.irecords[record.id]){this.irecords[record.id].remove()}record.id||(record.id=record.cid);this.records.push(record);this.irecords[record.id]=record;return this.irecords[record.cid]=record};Model.refresh=function(values,options){var record,records,result,_i,_len;if(options==null){options={}}if(options.clear){this.deleteAll()}records=this.fromJSON(values);if(!isArray(records)){records=[records]}for(_i=0,_len=records.length;_i<_len;_i++){record=records[_i];this.addRecord(record)}this.sort();result=this.cloneArray(records);this.trigger("refresh",result,options);return result};Model.select=function(callback){var record,_i,_len,_ref,_results;_ref=this.records;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){record=_ref[_i];if(callback(record)){_results.push(record.clone())}}return _results};Model.findByAttribute=function(name,value){var record,_i,_len,_ref;_ref=this.records;for(_i=0,_len=_ref.length;_i<_len;_i++){record=_ref[_i];if(record[name]===value){return record.clone()}}return null};Model.findAllByAttribute=function(name,value){return this.select(function(item){return item[name]===value})};Model.each=function(callback){var record,_i,_len,_ref,_results;_ref=this.records;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){record=_ref[_i];_results.push(callback(record.clone()))}return _results};Model.all=function(){return this.cloneArray(this.records)};Model.first=function(){var _ref;return(_ref=this.records[0])!=null?_ref.clone():void 0};Model.last=function(){var _ref;return(_ref=this.records[this.records.length-1])!=null?_ref.clone():void 0};Model.count=function(){return this.records.length};Model.deleteAll=function(){this.records=[];return this.irecords={}};Model.destroyAll=function(options){var record,_i,_len,_ref,_results;_ref=this.records;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){record=_ref[_i];_results.push(record.destroy(options))}return _results};Model.update=function(id,atts,options){return this.find(id).updateAttributes(atts,options)};Model.create=function(atts,options){var record;record=new this(atts);return record.save(options)};Model.destroy=function(id,options){return this.find(id).destroy(options)};Model.change=function(callbackOrParams){if(typeof callbackOrParams==="function"){return this.bind("change",callbackOrParams)}else{return this.trigger.apply(this,["change"].concat(__slice.call(arguments)))}};Model.fetch=function(callbackOrParams){if(typeof callbackOrParams==="function"){return this.bind("fetch",callbackOrParams)}else{return this.trigger.apply(this,["fetch"].concat(__slice.call(arguments)))}};Model.toJSON=function(){return this.records};Model.fromJSON=function(objects){var value,_i,_len,_results;if(!objects){return}if(typeof objects==="string"){objects=JSON.parse(objects)}if(isArray(objects)){_results=[];for(_i=0,_len=objects.length;_i<_len;_i++){value=objects[_i];_results.push(new this(value))}return _results}else{return new this(objects)}};Model.fromForm=function(){var _ref;return(_ref=new this).fromForm.apply(_ref,arguments)};Model.sort=function(){if(this.comparator){this.records.sort(this.comparator)}return this};Model.cloneArray=function(array){var value,_i,_len,_results;_results=[];for(_i=0,_len=array.length;_i<_len;_i++){value=array[_i];_results.push(value.clone())}return _results};Model.idCounter=0;Model.uid=function(prefix){var uid;if(prefix==null){prefix=""}uid=prefix+this.idCounter++;if(this.exists(uid)){uid=this.uid(prefix)}return uid};function Model(atts){Model.__super__.constructor.apply(this,arguments);
if(atts){this.load(atts)}this.cid=(atts!=null?atts.cid:void 0)||this.constructor.uid("c-")}Model.prototype.isNew=function(){return!this.exists()};Model.prototype.isValid=function(){return!this.validate()};Model.prototype.validate=function(){};Model.prototype.load=function(atts){var key,value;if(atts.id){this.id=atts.id}for(key in atts){value=atts[key];if(atts.hasOwnProperty(key)&&typeof this[key]==="function"){this[key](value)}else{this[key]=value}}return this};Model.prototype.attributes=function(){var key,result,_i,_len,_ref;result={};_ref=this.constructor.attributes;for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];if(key in this){if(typeof this[key]==="function"){result[key]=this[key]()}else{result[key]=this[key]}}}if(this.id){result.id=this.id}return result};Model.prototype.eql=function(rec){return!!(rec&&rec.constructor===this.constructor&&rec.cid===this.cid||rec.id&&rec.id===this.id)};Model.prototype.save=function(options){var error,record;if(options==null){options={}}if(options.validate!==false){error=this.validate();if(error){this.trigger("error",error);return false}}this.trigger("beforeSave",options);record=this.isNew()?this.create(options):this.update(options);this.stripCloneAttrs();this.trigger("save",options);return record};Model.prototype.stripCloneAttrs=function(){var key,value;if(this.hasOwnProperty("cid")){return}for(key in this){if(!__hasProp.call(this,key))continue;value=this[key];if(this.constructor.attributes.indexOf(key)>-1){delete this[key]}}return this};Model.prototype.updateAttribute=function(name,value,options){var atts;atts={};atts[name]=value;return this.updateAttributes(atts,options)};Model.prototype.updateAttributes=function(atts,options){this.load(atts);return this.save(options)};Model.prototype.changeID=function(id){var records;if(id===this.id){return}records=this.constructor.irecords;records[id]=records[this.id];delete records[this.id];this.id=id;return this.save()};Model.prototype.remove=function(){var i,record,records,_i,_len;records=this.constructor.records.slice(0);for(i=_i=0,_len=records.length;_i<_len;i=++_i){record=records[i];if(!this.eql(record)){continue}records.splice(i,1);break}this.constructor.records=records;delete this.constructor.irecords[this.id];return delete this.constructor.irecords[this.cid]};Model.prototype.destroy=function(options){if(options==null){options={}}this.trigger("beforeDestroy",options);this.remove();this.destroyed=true;this.trigger("destroy",options);this.trigger("change","destroy",options);if(this.listeningTo){this.stopListening()}this.unbind();return this};Model.prototype.dup=function(newRecord){var atts;if(newRecord==null){newRecord=true}atts=this.attributes();if(newRecord){delete atts.id}else{atts.cid=this.cid}return new this.constructor(atts)};Model.prototype.clone=function(){return createObject(this)};Model.prototype.reload=function(){var original;if(this.isNew()){return this}original=this.constructor.find(this.id);this.load(original.attributes());return original};Model.prototype.refresh=function(data){var root;root=this.constructor.irecords[this.id];root.load(data);this.trigger("refresh");return this};Model.prototype.toJSON=function(){return this.attributes()};Model.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"};Model.prototype.fromForm=function(form){var checkbox,key,name,result,_i,_j,_k,_len,_len1,_len2,_name,_ref,_ref1,_ref2;result={};_ref=$(form).find("[type=checkbox]:not([value])");for(_i=0,_len=_ref.length;_i<_len;_i++){checkbox=_ref[_i];result[checkbox.name]=$(checkbox).prop("checked")}_ref1=$(form).find('[type=checkbox][name$="[]"]');for(_j=0,_len1=_ref1.length;_j<_len1;_j++){checkbox=_ref1[_j];name=checkbox.name.replace(/\[\]$/,"");result[name]||(result[name]=[]);if($(checkbox).prop("checked")){result[name].push(checkbox.value)}}_ref2=$(form).serializeArray();for(_k=0,_len2=_ref2.length;_k<_len2;_k++){key=_ref2[_k];result[_name=key.name]||(result[_name]=key.value)}return this.load(result)};Model.prototype.exists=function(){return this.constructor.exists(this.id)};Model.prototype.update=function(options){var clone,records;this.trigger("beforeUpdate",options);records=this.constructor.irecords;records[this.id].load(this.attributes());this.constructor.sort();clone=records[this.id].clone();clone.trigger("update",options);clone.trigger("change","update",options);return clone};Model.prototype.create=function(options){var clone,record;this.trigger("beforeCreate",options);this.id||(this.id=this.cid);record=this.dup(false);this.constructor.addRecord(record);this.constructor.sort();clone=record.clone();clone.trigger("create",options);clone.trigger("change","create",options);return clone};Model.prototype.bind=function(events,callback){var binder,singleEvent,_fn,_i,_len,_ref,_this=this;this.constructor.bind(events,binder=function(record){if(record&&_this.eql(record)){return callback.apply(_this,arguments)}});_ref=events.split(" ");_fn=function(singleEvent){var unbinder;return _this.constructor.bind("unbind",unbinder=function(record,event,cb){if(record&&_this.eql(record)){if(event&&event!==singleEvent){return}if(cb&&cb!==callback){return}_this.constructor.unbind(singleEvent,binder);return _this.constructor.unbind("unbind",unbinder)}})};for(_i=0,_len=_ref.length;_i<_len;_i++){singleEvent=_ref[_i];_fn(singleEvent)}return this};Model.prototype.one=function(events,callback){var handler,_this=this;return this.bind(events,handler=function(){_this.unbind(events,handler);return callback.apply(_this,arguments)})};Model.prototype.trigger=function(){var args,_ref;args=1<=arguments.length?__slice.call(arguments,0):[];args.splice(1,0,this);return(_ref=this.constructor).trigger.apply(_ref,args)};Model.prototype.listenTo=function(){return Events.listenTo.apply(this,arguments)};Model.prototype.listenToOnce=function(){return Events.listenToOnce.apply(this,arguments)};Model.prototype.stopListening=function(){return Events.stopListening.apply(this,arguments)};Model.prototype.unbind=function(events,callback){var event,_i,_len,_ref,_results;if(arguments.length===0){return this.trigger("unbind")}else if(events){_ref=events.split(" ");_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){event=_ref[_i];_results.push(this.trigger("unbind",event,callback))}return _results}};return Model}(Module);Model.prototype.on=Model.prototype.bind;Model.prototype.off=Model.prototype.unbind;Controller=function(_super){__extends(Controller,_super);Controller.include(Events);Controller.include(Log);Controller.prototype.eventSplitter=/^(\S+)\s*(.*)$/;Controller.prototype.tag="div";function Controller(options){this.release=__bind(this.release,this);var context,key,parent_prototype,value,_ref;this.options=options;_ref=this.options;for(key in _ref){value=_ref[key];this[key]=value}if(!this.el){this.el=document.createElement(this.tag)}this.el=$(this.el);this.$el=this.el;if(this.className){this.el.addClass(this.className)}if(this.attributes){this.el.attr(this.attributes)}if(!this.events){this.events=this.constructor.events}if(!this.elements){this.elements=this.constructor.elements}context=this;while(parent_prototype=context.constructor.__super__){if(parent_prototype.events){this.events=$.extend({},parent_prototype.events,this.events)}if(parent_prototype.elements){this.elements=$.extend({},parent_prototype.elements,this.elements)}context=parent_prototype}if(this.events){this.delegateEvents(this.events)}if(this.elements){this.refreshElements()}Controller.__super__.constructor.apply(this,arguments)}Controller.prototype.release=function(){this.trigger("release",this);this.el.remove();this.unbind();return this.stopListening()};Controller.prototype.$=function(selector){return $(selector,this.el)};Controller.prototype.delegateEvents=function(events){var eventName,key,match,method,selector,_results,_this=this;_results=[];for(key in events){method=events[key];if(typeof method==="function"){method=function(method){return function(){method.apply(_this,arguments);return true}}(method)}else{if(!this[method]){throw new Error(""+method+" doesn't exist")}method=function(method){return function(){_this[method].apply(_this,arguments);return true}}(method)}match=key.match(this.eventSplitter);eventName=match[1];selector=match[2];if(selector===""){_results.push(this.el.bind(eventName,method))}else{_results.push(this.el.on(eventName,selector,method))}}return _results};Controller.prototype.refreshElements=function(){var key,value,_ref,_results;_ref=this.elements;_results=[];for(key in _ref){value=_ref[key];_results.push(this[value]=this.$(key))}return _results};Controller.prototype.delay=function(func,timeout){return setTimeout(this.proxy(func),timeout||0)};Controller.prototype.html=function(element){this.el.html(element.el||element);this.refreshElements();return this.el};Controller.prototype.append=function(){var e,elements,_ref;elements=1<=arguments.length?__slice.call(arguments,0):[];elements=function(){var _i,_len,_results;_results=[];for(_i=0,_len=elements.length;_i<_len;_i++){e=elements[_i];_results.push(e.el||e)}return _results}();(_ref=this.el).append.apply(_ref,elements);this.refreshElements();return this.el};Controller.prototype.appendTo=function(element){this.el.appendTo(element.el||element);this.refreshElements();return this.el};Controller.prototype.prepend=function(){var e,elements,_ref;elements=1<=arguments.length?__slice.call(arguments,0):[];elements=function(){var _i,_len,_results;_results=[];for(_i=0,_len=elements.length;_i<_len;_i++){e=elements[_i];_results.push(e.el||e)}return _results}();(_ref=this.el).prepend.apply(_ref,elements);this.refreshElements();return this.el};Controller.prototype.replace=function(element){var previous,_ref,_ref1;element=element.el||element;if(typeof element==="string"){element=$.trim(element)}_ref1=[this.el,$(((_ref=$.parseHTML(element))!=null?_ref[0]:void 0)||element)],previous=_ref1[0],this.el=_ref1[1];previous.replaceWith(this.el);this.delegateEvents(this.events);this.refreshElements();return this.el};return Controller}(Module);$=(typeof window!=="undefined"&&window!==null?window.jQuery:void 0)||(typeof window!=="undefined"&&window!==null?window.Zepto:void 0)||function(element){return element};createObject=Object.create||function(o){var Func;Func=function(){};Func.prototype=o;return new Func};isArray=function(value){return Object.prototype.toString.call(value)==="[object Array]"};isBlank=function(value){var key;if(!value){return true}for(key in value){return false}return true};makeArray=function(args){return Array.prototype.slice.call(args,0)};Spine=this.Spine={};if(typeof module!=="undefined"&&module!==null){module.exports=Spine}Spine.version="1.2.0";Spine.isArray=isArray;Spine.isBlank=isBlank;Spine.$=$;Spine.Events=Events;Spine.Log=Log;Spine.Module=Module;Spine.Controller=Controller;Spine.Model=Model;Module.extend.call(Spine,Events);Module.create=Module.sub=Controller.create=Controller.sub=Model.sub=function(instances,statics){var Result,_ref;Result=function(_super){__extends(Result,_super);function Result(){_ref=Result.__super__.constructor.apply(this,arguments);return _ref}return Result}(this);if(instances){Result.include(instances)}if(statics){Result.extend(statics)}if(typeof Result.unbind==="function"){Result.unbind()}return Result};Model.setup=function(name,attributes){var Instance,_ref;if(attributes==null){attributes=[]}Instance=function(_super){__extends(Instance,_super);function Instance(){_ref=Instance.__super__.constructor.apply(this,arguments);return _ref}return Instance}(this);Instance.configure.apply(Instance,[name].concat(__slice.call(attributes)));return Instance};Spine.Class=Module}).call(this);
//# sourceMappingURL=all.min.map